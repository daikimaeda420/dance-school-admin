generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")  // 6543
  directUrl = env("DIRECT_URL")    // 5432（shadow 用）
}

model Faq {
  id           String   @id @default(uuid())
  schoolId     String   @unique
  items        Json

  // ▲ 追加：チャットボットの見た目・CTA・吹き出し用
  palette      String   @default("gray") // テーマカラー
  ctaLabel     String?                   // CTA ボタン文言
  ctaUrl       String?                   // CTA ボタンURL

  launcherText String?                   // ★ NEW! ランチャーの吹き出し文言（例: "質問はコチラ"）

  updatedBy    String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([updatedAt])
}

model FaqLog {
  id        Int      @id @default(autoincrement())
  school    String   // 例: "daiki.maeda.web"
  sessionId String
  timestamp DateTime // 質問が行われた時刻

  question  String
  answer    String?
  url       String?

  createdAt DateTime @default(now())

  @@index([school])
  @@index([sessionId])
  @@index([timestamp])
}

// ユーザーの権限ロール
enum UserRole {
  SUPERADMIN
  SCHOOL_ADMIN
}

// JSON の users を移行する先のテーブル
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String
  passwordHash String
  role         UserRole
  schoolId     String

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([schoolId])
  @@index([role])
}

// SuperAdmin 一覧（メール＋schoolId）
model SuperAdmin {
  id        String   @id @default(cuid())
  email     String   @unique
  schoolId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/////////////////////////////////////////
// ここから診断機能用のモデルを追加
/////////////////////////////////////////

// エリア・校舎情報
model DiagnosisCampus {
  id        String   @id @default(cuid())
  schoolId  String   // どの school の診断か
  label     String   // 表示名（渋谷校など）
  slug      String   // "shibuya" など（Q1の option.id に使う想定）
  sortOrder Int      @default(0)
  isOnline  Boolean  @default(false)
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// クラス（コース）情報
model SchoolClass {
  id        String   @id @default(cuid())
  schoolId  String
  name      String                    // 例: "K-POP 超入門クラス"
  description String?
  // マッチング用タグ
  levels    String[]                  // 例: ["Lv0_超入門", "Lv1_入門"]
  targets   String[]                  // 例: ["Age_Teen", "Age_Student", "Age_Adult_Work"]
  genres    String[]                  // 例: ["Genre_KPOP"]
  schedule  String?                   // 例: "土曜・平日夜"
  isActive  Boolean   @default(true)

  teachers  TeacherClass[]            // 中間テーブル経由で Teacher へ

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([schoolId])
  @@index([isActive])
}

// 講師情報
model Teacher {
  id        String   @id @default(cuid())
  schoolId  String
  name      String
  photoUrl  String?
  styles    String[]                  // 例: ["Style_Healing", "Style_Friendly"]
  bio       String?

  classes   TeacherClass[]            // 担当クラスとの中間

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([schoolId])
}

// クラス×講師の中間テーブル
model TeacherClass {
  id         String      @id @default(cuid())
  classId    String
  teacherId  String

  clazz      SchoolClass @relation(fields: [classId], references: [id])
  teacher    Teacher     @relation(fields: [teacherId], references: [id])

  createdAt  DateTime    @default(now())

  @@index([classId])
  @@index([teacherId])
  @@unique([classId, teacherId])
}
